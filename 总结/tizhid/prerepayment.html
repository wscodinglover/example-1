<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link rel="stylesheet" href="css/mui.min.css" />
		<link rel="stylesheet" href="css/style.css" />
		<style>
			ul {
				font-size: 14px;
				color: #8f8f94;
			}
			.mui-btn {
				padding: 10px;
			}
			#yizhidai-prerepayment-body .mui-card{
				margin-bottom:10px;
			}
			.mui-table-view{
    			background-color: #efeff4;
			}
			.mui-table-view-cell {
			    padding: 8px 15px;
			}
			#yizhidai-prerepayment-body #submit{
				border: #0199e2;
				background-color: #0199e2;
			}
		</style>
	</head>
	<body class='yizhidai-body' id='yizhidai-prerepayment-body'>
		<header class="mui-bar mui-bar-nav" style="padding-right: 15px;box-shadow: 0 1px 0px #ccc;">
			<a class="mui-icon mui-icon-left-nav mui-pull-left" href='main.html'></a>
			<h1 class="mui-title">借款记录</h1>
		</header>
		<!--借还记录-->
		<div class="mui-content mui-content-padded" id="mui_content"></div>
		<div class="mui-content-padded">
			<button class='mui-btn mui-btn-block mui-btn-primary mui-action-back' id='submit' >返回</button>
		</div>
		<footer class='yizhidai-footer' id='yizhidai-main-footer'>
			<nav class="mui-bar mui-bar-tab">
		    <a class="mui-tab-item   mui-active" href="main.html">
		        <span class="mui-icon mui-icon-home"></span>
		        <span class="mui-tab-label">首页</span>
		    </a>
		    <a class="mui-tab-item"  href="member.html">
		        <span class="mui-icon mui-icon-contact"></span>
		        <span class="mui-tab-label">个人中心</span>
		    </a>
		    <a class="mui-tab-item" href="more.html">
		        <span class="mui-icon mui-icon-bars"></span>
		        <span class="mui-tab-label">帮助</span>
		    </a>
		</nav>
		</footer>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function($, doc) {
				$.init();
				$.plusReady(function() {
					var settings = app.getSettings();
					var state = app.getState();
					if (state.api_token) {
						app.userinfo(state.api_token, function(res) {
							if ((typeof res != 'object') && res.constructor != Object) {
								document.location.href = 'login.html';
								return;
							}
						});
					}else{
						document.location.href = 'login.html';
						return;
					}
					var loanInfo = {
						loan_status: '',
						api_token: state.api_token
					};
					app.loanlist(loanInfo, function(res) {
						//console.log(JSON.stringify(res));
						if ((typeof res != 'object') && res.constructor != Object) {
							doc.getElementById('loan_cotent').innerHTML = '<p style="text-align: center;margin-top: 20px;">暂无借还款记录.</p>';
							plus.nativeUI.toast(res);
							return;
						}
						if(res.length>0){
							for(var i=0; i<res.length; i++){
								var loan = res[i];
								var html_content = '<div class="mui-card"><div class="mui-card-content">';
								html_content += '<ul class="mui-table-view">';
								html_content += '<li class="mui-table-view-cell apply_time">申请时间：'+loan.created_at+'</li>';
								if(loan.loan_at){
									html_content += '<li class="mui-table-view-cell apply_time">放款时间：'+loan.loan_at+'</li>';
								}
								html_content += '<li class="mui-table-view-cell apply_time">贷款金额：'+loan.loan_amount+'元</li>';
								html_content += '<li class="mui-table-view-cell apply_time">贷款期限：'+loan.duration+'天</li>';
								if(loan.repayment_amount){
									html_content += '<li class="mui-table-view-cell apply_time">应还金额： '+loan.repayment_amount+'元</li>';
								}
								if(loan.repayment_time){
									html_content += '<li class="mui-table-view-cell apply_time">应还时间： '+loan.repayment_time+'</li>';
								}
								if(loan.repayment_at){
									html_content += '<li class="mui-table-view-cell apply_time">实还时间： '+loan.repayment_at+'</li>';
								}
								html_content += '<li class="mui-table-view-cell apply_time">借款状态：'+loan.status+'</li>';
								html_content += '</ul></div></div>';
								doc.getElementById('mui_content').innerHTML  += html_content;
							}	
						}else{
							doc.getElementById('mui_content').innerHTML = '<p style="text-align: center;margin-top: 20px;">暂无借还款记录</p>';
						}

					});
					$('.mui-bar-tab').on('tap', 'a', function(e) {
						if(this.href){
							document.location.href=this.href;						
						}
					});
				});
			}(mui, document));
		</script>
</body>
</html>